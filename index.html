<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEW TCG Deck Constructor</title>
    <link rel="stylesheet" href="style.css">

    <!-- =================================================================== -->
    <!--                  NEW: AUTOMATIC ERROR REPORTER                      -->
    <!-- =================================================================== -->
    <script>
        /**
         * This is our global error handler. It's placed directly in the HTML
         * to ensure it loads first and can catch any subsequent errors,
         * including module loading failures.
         */
        const handleError = (errorSource, message, source, lineno, colno, error) => {
            // Prevent firing multiple times for the same error
            if (window.errorHasOccurred) return;
            window.errorHasOccurred = true;

            // Gather all available information
            const report = `
========================================
   AEW Deck Constructor - Debug Report
========================================

An unexpected error occurred. Please send this file to the development team.

Timestamp: ${new Date().toISOString()}
Error Type: ${errorSource}

----------------------------------------
Error Details
----------------------------------------
Message: ${message}
Source File: ${source || 'N/A'}
Line Number: ${lineno || 'N/A'}
Column Number: ${colno || 'N/A'}

----------------------------------------
Browser Information
----------------------------------------
User Agent: ${navigator.userAgent}
Platform: ${navigator.platform}
Screen Resolution: ${window.screen.width}x${window.screen.height}

----------------------------------------
Stack Trace
----------------------------------------
${error && error.stack ? error.stack : 'Stack trace not available.'}

----------------------------------------
Application State (if available)
----------------------------------------
${window.state ? JSON.stringify(window.state.getStateSnapshot ? window.state.getStateSnapshot() : { note: 'State module not fully loaded.' }, null, 2) : 'State module not loaded.'}
            `;

            // Function to trigger the download
            const downloadReport = (content) => {
                const blob = new Blob([content.trim()], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'debug_report.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Display a user-friendly message on the screen
            document.body.innerHTML = `<div style="padding: 20px; font-family: sans-serif; text-align: center;">
                <h2>A Critical Error Occurred</h2>
                <p>We're sorry, but the application has crashed.</p>
                <p>An error report file named <strong>debug_report.txt</strong> should have been automatically downloaded.</p>
                <p>Please provide this file to help us fix the issue.</p>
            </div>`;

            downloadReport(report);
        };

        // Catch standard runtime errors
        window.onerror = handleError.bind(null, 'Standard Error');

        // Catch errors in promises that weren't handled (e.g., fetch failures)
        window.addEventListener('unhandledrejection', (event) => {
            handleError('Unhandled Promise Rejection', event.reason.message || 'No message', null, null, null, event.reason);
        });
    </script>
    <!-- =================================================================== -->
    <!--                  END OF AUTOMATIC ERROR REPORTER                    -->
    <!-- =================================================================== -->

</head>
<body>
    <!-- The application's HTML structure will be injected here by the scripts -->
    <!-- Or replaced by the error message if something goes wrong. -->
    <div id="loading-message" style="padding: 20px; text-align: center; font-size: 1.2em;">
        Loading AEW Deck Constructor...
    </div>

    <!-- The main script is now loaded at the end of the body -->
    <script type="module" src="main.js"></script>
</body>
</html>

